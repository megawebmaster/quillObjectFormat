var quillObjectFormat;quillObjectFormat=angular.module("QuillObjectFormat",["ngQuill"]);var QuillObjectFormat,bind=function(t,e){return function(){return t.apply(e,arguments)}};QuillObjectFormat=function(){function t(){this.$get=["$rootScope","$injector",this.factory]}var e,i,o;return e={offset:3,template:"<span class='object'></span> <a class='remove'>Remove object</a>"},i=-1e4,o={search:["$q",function(t){return function(e){var i;return i=t.defer(),i.resolve(e),i.promise}}],"node.add":function(){return function(t,e){return t.className="object label label-default",t.setAttribute("data-object",e.label),t.setAttribute("data-id",e.id),t}},"node.remove":function(){return function(t){return t.removeAttribute("class"),t.removeAttribute("data-object"),t.removeAttribute("data-id"),t}},"node.value":function(){return function(t){return t.getAttribute("data-id")}}},t.prototype.when=function(t,e){return o[t]=e},t.prototype.factory=function(t,i){var n,r,l,s;l={};for(r in o)s=o[r],l[r]=i.invoke(s);return n=function(){function t(t,i){var o;this.quill=t,this.formatElement=bind(this.formatElement,this),this.applyFormatting=bind(this.applyFormatting,this),this.bindToolbar=bind(this.bindToolbar,this),this.removeFormatting=bind(this.removeFormatting,this),this.selectionChange=bind(this.selectionChange,this),this.textChange=bind(this.textChange,this),this.options=jQuery.extend(i,e),o=jQuery(this.quill.addContainer("ql-tooltip")),o.addClass("ql-object-tooltip").html(this.options.template),this.utils=new QuillObjectFormatUtils(o,this.quill),this.utils.hide(),this.quill.on("text-change",this.textChange),this.quill.on("selection-change",this.selectionChange),this.quill.onModuleLoad("toolbar",this.bindToolbar),jQuery(".remove",o).on("click",this.removeFormatting)}return t.prototype.textChange=function(){return this.utils.isHidden()?void 0:this.utils.hide()},t.prototype.selectionChange=function(t){var e;if(null!=t&&t.isCollapsed())return e=this.utils.findObject(t),e?this.utils.show(e):this.utils.isHidden()?this.utils.hide():void 0},t.prototype.removeFormatting=function(t){var e;return t.preventDefault(),e=this.quill.getSelection(),e.isCollapsed()&&(e=this._expandRange(e)),this.quill.formatText(e,"object",null,"user"),null!=this.toolbar?this.toolbar.setActive("object",!1):void 0},t.prototype.bindToolbar=function(t){return this.toolbar=t,this.toolbar.initFormat("object",this.applyFormatting)},t.prototype.applyFormatting=function(t,e){var i;if(t)return e?t.isCollapsed()?void 0:(i=this.quill.getText(t.start,t.end),l.search(i).then(function(e){return function(i){return e.formatElement(t,i)}}(this))):this.quill.formatText(t,"object",null,"user")},t.prototype.formatElement=function(t,e){return t?this.quill.formatText(t,"object",e,"user"):void 0},t}(),{register:function(){return Quill.registerModule("object-format",n),t.$on("quill.created",function(t,e){return e.addFormat("object",{tag:"SPAN",add:l["node.add"],remove:function(t){return l["node.remove"](t.node)},value:l["node.value"]}),e.addModule("object-format"),e.addModule("toolbar",{container:document.querySelector("#quill-toolbar"),formats:{tooltip:{object:"object"}}})})}}},t}(),quillObjectFormat.provider("QuillObjectFormat",QuillObjectFormat);var QuillObjectFormatUtils,bind=function(t,e){return function(){return t.apply(e,arguments)}};QuillObjectFormatUtils=function(){function t(t,e){this.container=t,this.quill=e,this.findText=bind(this.findText,this),this.show=bind(this.show,this),this.object=jQuery(".object",container)}return t.prototype.isHidden=function(){return this.container.offset().left===HIDE_MARGIN},t.prototype.hide=function(){return this.container.offset({left:HIDE_MARGIN})},t.prototype.show=function(t){var e;return e=this._findText(t),this.container.css({left:e.left,top:e.top}),null==t.startOffset&&this.object.text(jQuery(t).data("object")),this.container.focus()},t.prototype.expandRange=function(t){var e,i,o;i=this.quill.editor.doc.findLeafAt(t.start,!0),o=t.start-i[1],e=o+i[0].length},t.prototype.findObject=function(t){var e,i,o;for(o=this.quill.editor.doc.findLeafAt(t.start,!0),e=o[0],null!=e&&(i=e.node);null!==i&&i!==this.quill.root;){if("SPAN"===i.tagName&&-1!==i.className.split(" ").indexOf("object"))return i;i=i.parentNode}return null},t.prototype.findText=function(t){var e,i,o,n,r,l,s;e=this.container.get(0),null!=t?(l=t.getBoundingClientRect(),r=this.quill.container.getBoundingClientRect(),o=l.left-r.left,n=l.top-r.top,i=o+l.width/2-e.offsetWidth/2,s=n+l.height+this.options.offset,s+e.offsetHeight>this.quill.container.offsetHeight&&(s=n-e.offsetHeight-this.options.offset),i=Math.min(i,this.quill.container.offsetWidth-e.offsetWidth),s=Math.min(s,this.quill.container.offsetHeight-e.offsetHeight)):(i=this.quill.container.offsetWidth/2-e.offsetWidth/2,s=this.quill.container.offsetHeight/2-e.offsetHeight/2),s+=this.quill.container.scrollTop},t}();